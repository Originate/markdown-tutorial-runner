#!/usr/bin/env bash
set -e

# LINTS THE JAVASCRIPT FILES

# NOTE: cannot dry this code up because the details are different in each block


# run the 'standard-js' linter on the source code
standard -v 'src/**/*.js'

# run the 'standard-js' linter on the test code
errors=$(standard -v 'test/**/*.js' | grep -v no-unused-expressions | wc -l | tr -d ' ')
if [ $errors -gt 0 ]; then
  echo Found standardJS errors in the test code:
  standard -v 'test/**/*.js' | grep -v no-undef
  exit 1
fi

# run the 'standard-js' linter on the feature code
errors=$(standard -v 'features/support/**/*.js' | grep -v no-unused-expressions | wc -l | tr -d ' ')
if [ $errors -gt 0 ]; then
  echo Found standardJS errors in the feature code:
  standard -v 'features/**/*.js' | grep -v no-unused-expressions
  exit 1
fi

# run the Flow type checker
node_modules/.bin/flow

# lint package.json
node_modules/.bin/dependency-lint
